/**
 * @license
 * Copyright (c) 2014 The Polymer Project Authors. All rights reserved.
 * This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
 * The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
 * The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
 * Code distributed by Google as part of the polymer project is also
 * subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
 */
// @version 0.7.7
"undefined"==typeof WeakMap&&!function(){var e=Object.defineProperty,t=Date.now()%1e9,r=function(){this.name="__st"+(1e9*Math.random()>>>0)+(t++ +"__")};r.prototype={set:function(t,r){var i=t[this.name];return i&&i[0]===t?i[1]=r:e(t,this.name,{value:[t,r],writable:!0}),this},get:function(e){var t;return(t=e[this.name])&&t[0]===e?t[1]:void 0},"delete":function(e){var t=e[this.name];return t&&t[0]===e?(t[0]=t[1]=void 0,!0):!1},has:function(e){var t=e[this.name];return t?t[0]===e:!1}},window.WeakMap=r}(),function(e){function t(e){O.push(e),N||(N=!0,b(i))}function r(e){return window.ShadowDOMPolyfill&&window.ShadowDOMPolyfill.wrapIfNeeded(e)||e}function i(){N=!1;var e=O;O=[],e.sort(function(e,t){return e.uid_-t.uid_});var t=!1;e.forEach(function(e){var r=e.takeRecords();n(e),r.length&&(e.callback_(r,e),t=!0)}),t&&i()}function n(e){e.nodes_.forEach(function(t){var r=p.get(t);r&&r.forEach(function(t){t.observer===e&&t.removeTransientObservers()})})}function a(e,t){for(var r=e;r;r=r.parentNode){var i=p.get(r);if(i)for(var n=0;n<i.length;n++){var a=i[n],s=a.options;if(r===e||s.subtree){var o=t(s);o&&a.enqueue(o)}}}}function s(e){this.callback_=e,this.nodes_=[],this.records_=[],this.uid_=++M}function o(e,t){this.type=e,this.target=t,this.addedNodes=[],this.removedNodes=[],this.previousSibling=null,this.nextSibling=null,this.attributeName=null,this.attributeNamespace=null,this.oldValue=null}function d(e){var t=new o(e.type,e.target);return t.addedNodes=e.addedNodes.slice(),t.removedNodes=e.removedNodes.slice(),t.previousSibling=e.previousSibling,t.nextSibling=e.nextSibling,t.attributeName=e.attributeName,t.attributeNamespace=e.attributeNamespace,t.oldValue=e.oldValue,t}function u(e,t){return D=new o(e,t)}function h(e){return w?w:(w=d(D),w.oldValue=e,w)}function c(){D=w=void 0}function v(e){return e===w||e===D}function l(e,t){return e===t?e:w&&v(e)?w:null}function f(e,t,r){this.observer=e,this.target=t,this.options=r,this.transientObservedNodes=[]}var b,p=new WeakMap;if(/Trident|Edge/.test(navigator.userAgent))b=setTimeout;else if(window.setImmediate)b=window.setImmediate;else{var g=[],m=String(Math.random());window.addEventListener("message",function(e){if(e.data===m){var t=g;g=[],t.forEach(function(e){e()})}}),b=function(e){g.push(e),window.postMessage(m,"*")}}var N=!1,O=[],M=0;s.prototype={observe:function(e,t){if(e=r(e),!t.childList&&!t.attributes&&!t.characterData||t.attributeOldValue&&!t.attributes||t.attributeFilter&&t.attributeFilter.length&&!t.attributes||t.characterDataOldValue&&!t.characterData)throw new SyntaxError;var i=p.get(e);i||p.set(e,i=[]);for(var n,a=0;a<i.length;a++)if(i[a].observer===this){n=i[a],n.removeListeners(),n.options=t;break}n||(n=new f(this,e,t),i.push(n),this.nodes_.push(e)),n.addListeners()},disconnect:function(){this.nodes_.forEach(function(e){for(var t=p.get(e),r=0;r<t.length;r++){var i=t[r];if(i.observer===this){i.removeListeners(),t.splice(r,1);break}}},this),this.records_=[]},takeRecords:function(){var e=this.records_;return this.records_=[],e}};var D,w;f.prototype={enqueue:function(e){var r=this.observer.records_,i=r.length;if(r.length>0){var n=r[i-1],a=l(n,e);if(a)return void(r[i-1]=a)}else t(this.observer);r[i]=e},addListeners:function(){this.addListeners_(this.target)},addListeners_:function(e){var t=this.options;t.attributes&&e.addEventListener("DOMAttrModified",this,!0),t.characterData&&e.addEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.addEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.addEventListener("DOMNodeRemoved",this,!0)},removeListeners:function(){this.removeListeners_(this.target)},removeListeners_:function(e){var t=this.options;t.attributes&&e.removeEventListener("DOMAttrModified",this,!0),t.characterData&&e.removeEventListener("DOMCharacterDataModified",this,!0),t.childList&&e.removeEventListener("DOMNodeInserted",this,!0),(t.childList||t.subtree)&&e.removeEventListener("DOMNodeRemoved",this,!0)},addTransientObserver:function(e){if(e!==this.target){this.addListeners_(e),this.transientObservedNodes.push(e);var t=p.get(e);t||p.set(e,t=[]),t.push(this)}},removeTransientObservers:function(){var e=this.transientObservedNodes;this.transientObservedNodes=[],e.forEach(function(e){this.removeListeners_(e);for(var t=p.get(e),r=0;r<t.length;r++)if(t[r]===this){t.splice(r,1);break}},this)},handleEvent:function(e){switch(e.stopImmediatePropagation(),e.type){case"DOMAttrModified":var t=e.attrName,r=e.relatedNode.namespaceURI,i=e.target,n=new u("attributes",i);n.attributeName=t,n.attributeNamespace=r;var s=e.attrChange===MutationEvent.ADDITION?null:e.prevValue;a(i,function(e){return!e.attributes||e.attributeFilter&&e.attributeFilter.length&&-1===e.attributeFilter.indexOf(t)&&-1===e.attributeFilter.indexOf(r)?void 0:e.attributeOldValue?h(s):n});break;case"DOMCharacterDataModified":var i=e.target,n=u("characterData",i),s=e.prevValue;a(i,function(e){return e.characterData?e.characterDataOldValue?h(s):n:void 0});break;case"DOMNodeRemoved":this.addTransientObserver(e.target);case"DOMNodeInserted":var o,d,v=e.target;"DOMNodeInserted"===e.type?(o=[v],d=[]):(o=[],d=[v]);var l=v.previousSibling,f=v.nextSibling,n=u("childList",e.target.parentNode);n.addedNodes=o,n.removedNodes=d,n.previousSibling=l,n.nextSibling=f,a(e.relatedNode,function(e){return e.childList?n:void 0})}c()}},e.JsMutationObserver=s,e.MutationObserver||(e.MutationObserver=s)}(this);
/*! qed 1.0.0 2015-12-15 */
!function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.Qed=b()}(this,function(){"use strict";function a(a){null==a.which&&(a.which=null!=a.charCode?a.charCode:a.keyCode)}function b(a){for(var b=0,c=a.previousElementSibling;c;)b++,c=c.previousElementSibling;return b}function c(a,b){return a.children[b]}function d(a,b){return a.childNodes[b]}function e(a){return a?a.replace(/[<>]/g,function(a){return"<"===a?"&lt;":"&gt;"}):""}function f(a,b,c){for(var d=a;d&&d!=b;)if(c(d))return d;return null}function g(a,b){if(a.closest)return a.closest(b);for(var c=a,b=b.toUpperCase();c&&c.tagName.toUpperCase()!==b;)c=c.parentNode;return c}function h(){return void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft}function i(){return void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop}function j(a,b){var c=a.classList;if(void 0===c){var d=a.className?a.className.trim().split(/\s+/):[],e=d.indexOf(b);-1===e&&(d.push(b),a.className=d.join(" "))}else c.add(b);return a}function k(a,b){var c=a.classList;if(void 0===c){var d=a.className?a.className.trim().split(/\s+/):[],e=d.indexOf(b);e>-1&&(d.splice(e,1),a.className=d.join(" "))}else c.remove(b);return a}function l(a,b){var c=a.classList;if(void 0===c){var d=a.className?a.className.trim().split(/\s+/):[],e=d.indexOf(b);return e>-1}return c.contains(b)}function m(a,b){for(var c=a.parentNode,d=a,e=a.nextElementSibling;d&&d!==b;)e=d.nextElementSibling,c.removeChild(d),d=e;return d&&(e=d.nextElementSibling,c.removeChild(d)),e}function n(a){for(var b=a;b.lastChild;)b.removeChild(b.lastChild)}function o(a){a.style.display=""}function p(a){a.style.display="none"}function q(a,b){var c=b.getBoundingClientRect();c.bottom>a.clientHeight&&(a.scrollTop+=c.bottom-a.clientHeight)}function r(a,b,c){if(!c&&b.firstChild)return b.firstChild;if(b===a)return null;if(b.nextSibling)return b.nextSibling;for(var d=b.parentNode;d&&a!==d;){if(d.nextSibling)return d.nextSibling;d=d.parentNode}return null}function s(a,b){for(b=r(a,b,!0);b&&3!==b.nodeType;)b=r(a,b);return b}function t(a){for(var b=r(a,a);b&&3!==b.nodeType;)b=r(a,b);return b}function u(a,b,c){if(!c&&b.lastChild)return b.lastChild;if(b===a)return null;if(b.previousSibling)return b.previousSibling;for(var d=b.parentNode;d&&a!==d;){if(d.previousSibling)return d.previousSibling;d=d.parentNode}return null}function v(a,b){for(b=u(a,b,!0);b&&3!==b.nodeType;)b=u(a,b);return b}function w(a){for(var b=u(a,a);b&&3!==b.nodeType;)b=u(a,b);return b}function x(a,b){for(var c=0,d=t(a);d;){var e=d.nodeValue.length;if(e+c>=b)return[d,b-c];c+=e,d=s(a,d)}return null}function y(a,b,c){for(var d=0,e=t(a);e;){if(e===b)return d+c;d+=e.nodeValue.length,e=s(a,e)}return-1}function z(a,b){this.listeners=a,this.listener=b,this.remove=function(){var a=this.listeners.indexOf(this.listener);return a>-1?(this.listeners.splice(a,1),this.listener):null},this.get=function(){return this.listener}}function A(a){this.listeners=[],this.allowCancelation=!1,this.ctx=a||null,this.add=function(a){var b=this.listeners.indexOf(a);return-1===b?(this.listeners.push(a),new z(this.listeners,a)):new z(this.listeners,a)},this.remove=function(a){var b=this.listeners.indexOf(this.listener);return b>-1?this.listeners.splice(b,1)[0]:null},this.fire=function(){var a=Array.prototype.slice.call(arguments),b=this.listeners,c=this.ctx;if(this.allowCancelation){for(var d=0,e=b.length;e>d;d++)if(b[d].apply(c,a)===!1)return}else for(var d=0,e=b.length;e>d;d++)b[d].apply(c,a)},this.fireAsync=function(){null!==this.asyncTimer&&(window.clearTimeout(this.asyncTimer),this.asyncTimer=null);var a=this;this.asyncTimer=window.setTimeout(function(){try{}finally{a.asyncTimer=null}},this.timeout)}}function B(a,b){this.listeners=[],this.ctx=a,this.timeout=b||0,this.timer=null,this.add=function(a){var b=this.listeners.indexOf(a);return-1===b?(this.listeners.push(a),new z(this.listeners,a)):new z(this.listeners,a)},this.remove=function(a){var b=this.listeners.indexOf(this.listener);return b>-1?this.listeners.splice(b,1)[0]:null},this.fireNow=function(){for(var a=this.listeners,b=this.ctx,c=0,d=a.length;d>c;c++)a[c].apply(b)},this.fireWhenIdle=function(){null!==this.timer&&(window.clearTimeout(this.timer),this.timer=null);var a=this;this.timer=window.setTimeout(function(){try{a.fireNow()}finally{a.timer=null}},this.timeout)},this.fire=function(){if(null===this.timer){var a=this;this.timer=window.setTimeout(function(){try{a.fireNow()}finally{a.timer=null}},this.timeout)}}}function C(){return window.getSelection()}function D(){return document.createRange()}function E(a){if(!a)return[0,null];var b=pa.exec(a);return b?[b.index,b[1]]:[0,null]}function F(a){if(!a)return[0,null];var b=oa.exec(a);return b?[b.index+b[0].length,b[1]]:[0,null]}function G(a,b,c){if(c){var d=a.substring(0,b);return E(d)}var e=a.substring(b),f=F(e);return f[0]+=b,f}function H(a){function b(a,b){return 0===b?"":a=b===a.length&&a.length>0&&10===a.charCodeAt(b-1)?a.substring(0,b-1):a.substring(0,b)}function c(a,b){return b>=a.length?"":a=a.length>0&&10===a.charCodeAt(a.length-1)?a.substring(b,a.length-1):a.substring(b)}function d(a,b){return a.substring(0,b.length)===b?a.substring(b.length):null}this.doc=a,this.anchorLine=null,this.anchorOffset=0,this.focusLine=null,this.focusOffset=0,this.clone=function(){var a=new H(this.doc);return a.anchorLine=this.anchorLine,a.anchorOffset=this.anchorOffset,a.focusLine=this.focusLine,a.focusOffset=this.focusOffset,a},this.isCollapsed=function(){return this.anchorOffset===this.focusOffset&&this.anchorLine.elem===this.focusLine.elem},this.isMultiline=function(){return this.anchorLine.elem!==this.focusLine.elem},this.isBackwards=function(){return this.anchorLine.elem===this.focusLine.elem?this.anchorOffset>this.focusOffset:this.anchorLine.getLineIndex()>this.focusLine.getLineIndex()},this.isValid=function(){return this.anchorLine&&this.focusLine},this.save=function(){return[this.anchorLine.getLineIndex(),this.anchorOffset,this.focusLine.getLineIndex(),this.focusOffset]},this.restore=function(a){return this.anchorLine=this.doc.getLineAt(a[0]),this.anchorOffset=a[1],a[0]===a[2]&&(this.focusLine=this.anchorLine),this.focusLine=this.doc.getLineAt(a[2]),this.focusOffset=a[3],this},this.asDomRange=function(){if(!this.isValid())return null;var a,b=x(this.anchorLine.elem,this.anchorOffset);if(!b)return null;if(this.isCollapsed())a=b;else if(a=x(this.focusLine.elem,this.focusOffset),!a)return null;var c=D();return b[1]<0&&(console.error("anchor offset is negative",b),b[1]=0),a[1]<0&&(console.error("focus offset is negative",b),a[1]=0),c.setStart(b[0],b[1]),c.setEnd(a[0],a[1]),c},this.select=function(a){var b=this.asDomRange();return b?(a||(a=C()),a.removeAllRanges(),a.addRange(b),this.doc.elem.focus(),this):this},this.fromSelection=function(a){return a||(a=C()),a.anchorNode&&a.focusNode?a.isCollapsed?(this.anchorLine=this.focusLine=this.doc.getLine(a.anchorNode),this.anchorLine&&(this.anchorOffset=this.focusOffset=y(this.anchorLine.elem,a.anchorNode,a.anchorOffset)),this):(this.anchorLine=this.doc.getLine(a.anchorNode),a.anchorNode===a.focusNode?this.focusLine=this.anchorLine:this.focusLine=this.doc.getLine(a.focusNode),this.anchorLine&&this.focusLine&&(this.anchorOffset=y(this.anchorLine.elem,a.anchorNode,a.anchorOffset),this.focusOffset=y(this.focusLine.elem,a.focusNode,a.focusOffset)),this):this},this.set=function(a,b,c,d){return void 0===c?(this.anchorLine=a,this.anchorOffset=b,this.focusLine=a,this.focusOffset=b):void 0===d?(this.anchorLine=a,this.anchorOffset=b,this.focusLine=a,this.focusOffset=c):(this.anchorLine=a,this.anchorOffset=b,this.focusLine=c,this.focusOffset=d),this},this.collapse=function(a){return a?(this.focusOffset=this.anchorOffset,this.focusLine=this.anchorLine):(this.anchorOffset=this.focusOffset,this.anchorLine=this.focusLine),this},this.expandTo=function(a,b){return this.focusLine=a,this.focusOffset=b,this},this.expandToBoundingLines=function(){return this.reverseIfBackwards(),this.anchorOffset=0,this.focusOffset=this.focusLine.getEndOfLineOffset(),this},this.collapseTo=function(a,b){return this.anchorLine=this.focusLine=a,this.focusOffset=this.anchorOffset=b,this},this.collapseToEnd=function(a){return this.collapseTo(a,a.getEndOfLineOffset())},this.collapseToBegin=function(a){return this.collapseTo(a,0)},this.reverse=function(){var a=this.focusLine,b=this.focusOffset;return this.focusLine=this.anchorLine,this.anchorLine=a,this.focusOffset=this.anchorOffset,this.anchorOffset=b,this},this.reverseIfBackwards=function(){return this.isBackwards()?(this.reverse(),!0):!1},this.getFirstLine=function(){return this.isBackwards()?this.focusLine:this.anchorLine},this.getLastLine=function(){return this.isBackwards()?this.focusLine:this.anchorLine},this.getFirstLineOffset=function(){return this.isBackwards()?this.focusOffset:this.anchorOffset},this.getLastLineOffset=function(){return this.isBackwards()?this.focusLine:this.anchorLine},this.getText=function(){if(!this.isValid()||this.isCollapsed())return"";if(this.isMultiline()){var a,b,c,d;this.isBackwards()?(a=this.focusLine,c=this.focusOffset,b=this.anchorLine,d=this.anchorOffset):(a=this.anchorLine,c=this.anchorOffset,b=this.focusLine,d=this.focusOffset);for(var e=a.getText().substring(c),f=a.elem.nextElementSibling,g=b.elem.previousElementSibling;f&&f!==g;)e+=f.textContent,f=f.nextElementSibling;return e+=b.getText().substring(0,d)}var h,i;this.focusOffset>this.anchorOffset?(h=this.anchorOffset,i=this.focusOffset):(h=this.focusOffset,i=this.anchorOffset);var e=this.focusLine.getText().substring(h,i);return e.length>0&&10===e.charCodeAt(e.length-1)&&(e=e.substring(0,e.length-1)),e},this.getBoundingText=function(){return[b(this.anchorLine.getText(),this.anchorOffset),c(this.focusLine.getText(),this.focusOffset)]},this.refresh=function(){if(this.isMultiline()){this.reverseIfBackwards(),this.anchorNode.setText(null);for(var a=this.doc.formatter,b=this.anchorNode.elem.nextElementSibling,c=this.focusNode.elem;b&&b!==c;)a.updateLine(b);this.focusNode.setText(null)}else this.focusLine.setText(null);return this},this.removeLines=function(){this.reverseIfBackwards();var a=this.doc.formatter.removeLines(firstLine,lastLine);return this.collapseTo(new O(this.doc,a),0)},this.removeText=function(){if(this.isCollapsed())return this;this.reverseIfBackwards();var a=this.getBoundingText(),b=this.doc.formatter.replaceLines(this.anchorLine.elem,this.focusLine.elem,[a[0]+a[1]]);return this.collapseTo(new O(this.doc,b),a[0].length)},this.insertText=function(a){if(!a)return this.removeText();this.reverseIfBackwards();var b,c=this.getBoundingText(),d=L(c[0]+a+c[1]).split("\n"),e=this.doc.formatter.replaceLines(this.anchorLine.elem,this.focusLine.elem,d);if(10===a.charCodeAt(a.length-1))b=0;else{var f=d[d.length-1];b=f.length-c[1].length}return this.collapseTo(new O(this.doc,e),b)},this.setLineText=function(a,b){return this.collapse(b),this.focusLine.setText(a),this.focusOffset>a.length&&(this.anchorOffset=this.focusOffset=a.length),this},this.replaceLineText=function(a,b,c,d){this.collapse(d);var e,f=this.focusOffset,g=this.focusLine.getText();return 0>c?e=g.substring(0,b)+a:c?(e=g.substring(0,b)+a+g.substring(b+c),f>=b&&(b+c>f?f=b+a.length:f+=a.length-c)):(e=g.substring(0,b)+a+g.substring(b),f>=b&&(f+=a.length)),0>f?f=0:f>e.length&&(f=e.length),this.focusLine.setText(e),this.anchorOffset=this.focusOffset=f,this},this.split=function(a){this.reverseIfBackwards();var b=this.getBoundingText();a&&b[0].length>0&&(b[0]+="  ");var c=this.doc.formatter.split(this.anchorLine.elem,b[0],b[1],a),d=this.doc.formatter.replaceLines(this.anchorLine.elem,this.focusLine.elem,c);if(c.focusLine<c.length-1){for(var e=c.focusLine,f=c.length-1,g=d;g&&f>e;)g=g.previousElementSibling,f--;g&&(d=g)}return this.collapseTo(new O(this.doc,d),c.focusOffset)},this.prefixLines=function(a){if(this.reverseIfBackwards(),this.isCollapsed()){var b=this.focusLine.getText();this.focusLine.setText(a+b),this.anchorOffset=this.focusOffset=this.focusOffset+a.length}else{for(var c=this.anchorLine.elem,d=this.focusLine.elem,e=d.nextElementSibling,f=c,g=[];f&&f!==e;)g.push(a+f.textContent),f=f.nextElementSibling;f=c.previousElementSibling,d=this.doc.formatter.replaceLines(c,d,g),c=f?f.nextElementSibling:d.parentNode.firstElementChild,this.anchorLine=new O(this.doc,c),this.anchorOffset=0,this.focusLine=new O(this.doc,d),this.focusOffset=d.textContent.length-1}return this},this.unprefixLines=function(a){if(this.reverseIfBackwards(),this.isCollapsed()){var b=d(this.focusLine.getText(),a);null!==b&&(this.focusLine.setText(b),this.anchorOffset=this.focusOffset=this.focusOffset<a.length?0:this.focusOffset-a.length)}else{for(var c=this.anchorLine.elem,e=this.focusLine.elem,f=e.nextElementSibling,g=c,h=[];g&&g!==f;){var b=g.textContent,i=d(b,a);null===i&&(i=b),h.push(i),g=g.nextElementSibling}g=c.previousElementSibling,e=this.doc.formatter.replaceLines(c,e,h),c=g?g.nextElementSibling:e.parentNode.firstElementChild,this.anchorLine=new O(this.doc,c),this.anchorOffset=0,this.focusLine=new O(this.doc,e),this.focusOffset=e.textContent.length-1}return this},this.removeNextCharacter=function(){if(!this.isCollapsed())return this.removeText();var a=this.focusLine.getText();if(this.focusOffset>=a.length-1){var b=this.focusLine.next();if(b){var c=b.getText(),d=this.doc.formatter.replaceLines(this.focusLine.elem,b.elem,[M(a)+c]);b._setElement(d),this.collapseTo(b,this.focusOffset)}}else this.focusLine.setText(a.substring(0,this.focusOffset)+a.substring(this.focusOffset+1));return this},this.removePreviousCharacter=function(){if(!this.isCollapsed())return this.removeText();var a=this.focusLine,b=a.getText();if(b&&"\n"!==b)if(0===this.focusOffset){var c=a.previous();if(c){var d=M(c.getText()),e=this.doc.formatter.replaceLines(c.elem,this.focusLine.elem,[d+b]);c._setElement(e),this.collapseTo(c,d.length)}}else this.focusLine.setText(b.substring(0,this.focusOffset-1)+b.substring(this.focusOffset)),this.anchorOffset=this.focusOffset=this.focusOffset-1;else{var c=a.previous();c&&(this.doc.formatter.removeLine(a.elem),this.collapseToEnd(c))}return this},this.removeNextWord=function(){if(!this.isCollapsed())return this.removeText();var a=this.focusLine.getText(),b=G(a,this.focusOffset,!1);if(!b[1]&&b[0]===a.length){var c=this.focusLine.next();if(c)return a=c.getText(),b=G(a,0,!1),this.focusLine=c,this.focusOffet=b[0],this.removeText()}return this.focusOffset=b[0],this.removeText()},this.removePreviousWord=function(){if(!this.isCollapsed())return this.removeText();var a=this.focusLine.getText(),b=G(a,this.focusOffset,!0);if(!b[1]&&0===b[0]){var c=this.focusLine.previous();if(c)return a=c.getText(),b=G(a,a.length,!0),this.focusLine=c,this.focusOffset=b[0],this.removeText()}return this.focusOffset=b[0],this.removeText()},this.takeSnapshot=function(){var a=new Q;return a.focus=this.save(),a.text=this.doc.getText(),a},this.getCaretXY=function(){var a=x(this.focusLine.elem,this.focusOffset),b=a[0],c=b.nodeValue,d=c.substring(0,a[1]),e=c.substring(a[1])||"​",f=document.createElement("SPAN");f.appendChild(document.createTextNode(e)),b.nodeValue=d,b.nextSibling?b.nextSibling.insertBefore(f,b.nextSibling):b.parentNode.appendChild(f);var g=f.getBoundingClientRect(),j=[g.left+h(),g.top+i()];return f.parentNode.removeChild(f),b.nodeValue=c,this.select(),j}}function I(){function a(){return document.createElement("DIV")}function b(){var a=document.createElement("DIV");return a.appendChild(document.createTextNode("\n")),a}function c(a){if(!a)return!1;var b=a.getAttribute("data-block");return b&&"end"!==b}function d(a){return a.getAttribute("data-line-type")}function f(a){return"alt-heading"===a.getAttribute("data-line-type")}function g(a,b){for(;b&&b!==a;){if("I"===b.nodeName.toUpperCase())return!0;b=b.parentNode}return!1}function h(a,b){if(b)if(J(a)){b.removeAttribute("data-heading-title");var c=a.nextElementSibling;if(c&&f(c)){var d=c.getAttribute("data-level")||"1";k(c,"qed-h"+d+"-alt")}}else if(f(a)){if(!J(b)){var d=a.getAttribute("data-level")||"1";j(a,"qed-h"+d+"-alt"),b.setAttribute("data-heading-title",d)}}else b.removeAttribute("data-heading-title")}function i(a,b,c){var d=u(c,b.textContent);return a.replaceChild(d,b),d}function l(a,b){var d=c(b),e=a.getAttribute("data-block");if(!!d==!!e)return a;var f=a.parentNode,g=b;do a=i(f,a,b),h(a,b),b=a,a=a.nextElementSibling;while(a);return g?g.nextElementSibling:f.firstElementChild}function o(a,b){return"<span data-token-type='"+a+"' class='qed-style-"+a+"'>"+b+"</span>"}function p(a){return"<i>"+a+"</i>"}function q(a){return"<i>"+a+"</i>"}function r(a){return"<i>\\</i>"+a}function s(a,b,c){return o(a,"<i>"+b+"</i>"+c+"<i>"+b+"</i>")}function t(a,b){for(var c=a.length;c>b&&a.charCodeAt(b)<=32;)b++;return b}function u(a,b){var d=c(a);if(d)var e=v(b);else var e=w(a,b);return j(e,"qed-line"),e}function v(c){if(!c||"\n"===c){var d=b();return d.setAttribute("data-block","line"),d}10!==c.charCodeAt(c.length-1)&&(c+="\n");var d=a(),e=X.exec(c);return e?x(d,c,!0):(d.setAttribute("data-block","line"),d.innerHTML=H(c),d)}function w(c,d){if(!d||"\n"===d)return b();10!==d.charCodeAt(d.length-1)&&(d+="\n");var e,f,g=a(),h=t(d,0),i=d.charCodeAt(h),j=9===d.charCodeAt(0);if(c?(e=K(c),f=c.getAttribute("data-line-type")):(e=!0,f=null),(h>=4||j)&&(!c||"code"===f||"heading"===f||"alt-heading"===f||e))return y(g,d,h,j);switch(i){case 35:var k=Y.exec(d);if(k)return A(g,d,k[0].length,k[1].length);break;case 45:var k;if(!e&&"heading"!==f&&(k=ca.exec(d)))return z(g,d,2);if(32===d.charCodeAt(h+1))return B(g,d,h+2,"-");break;case 42:if(32===d.charCodeAt(h+1))return B(g,d,h+2,"*");break;case 43:if(32===d.charCodeAt(h+1))return B(g,d,h+2,"+");break;case 62:var k=aa.exec(d);if(k)return C(g,d,k[0].length);break;case 96:var k=X.exec(d);if(k)return x(g,d);break;case 61:if(!e&&"heading"!==f){var k=ba.exec(d);if(k)return z(g,d,1)}break;default:if(58>i&&i>48){var k=Z.exec(d);if(k)return B(g,d,k[0].length,k[1])}}return D(g,d,null)}function x(a,b,c){return a.setAttribute("data-line-type","alt-code"),a.setAttribute("data-block",c?"end":"start"),a.innerHTML=p(b.substring(0,3))+H(b.substring(3)),a}function y(a,b,c,d){var e=d?"tab":"spaces";return a.setAttribute("data-line-type","code"),a.setAttribute("data-indent",e),j(a,"qed-code-line"),a.innerHTML=p(b.substring(0,c))+H(b.substring(c)),a}function z(a,b,c){return a.setAttribute("data-line-type","alt-heading"),a.setAttribute("data-level",c),a.innerHTML=b,a}function A(a,b,c,d){return a.setAttribute("data-line-type","heading"),a.setAttribute("data-level",d),j(a,"qed-h"+d),a.innerHTML=p(b.substring(0,c))+I(b.substring(c)),a}function B(a,b,c,d){return a.setAttribute("data-line-type","li"),a.setAttribute("data-bullet",d),a.innerHTML=p(b.substring(0,c))+I(b.substring(c)),a}function C(a,b,c){return a.setAttribute("data-line-type","quote"),a.innerHTML=p(b.substring(0,c))+I(b.substring(c)),a}function D(a,b,c){c&&j(a,c);var d=I(b),e=d.length;return d.length>2&&32===d.charCodeAt(e-3)&&32===d.charCodeAt(e-2)&&10===d.charCodeAt(e-1)&&(d=d.substring(0,e-3)+"<i class='qed-br'>  </i>\n"),a.innerHTML=d,a}function E(a,b,c){var d,e;return 33===a.charCodeAt(0)?(d="image",e="!["):(d="link",e="["),"<span data-token-type='"+d+"'><i>"+e+"</i><span class='qed-link-text'>"+b+"</span><i>](</i><span class='qed-link-url'>"+c+"</span><i>)</i></span>"}function F(a,b,c,d){return"<span data-token-type='link-ref'><i>[</i><span class='qed-link-text'>"+b+"</span><i>]"+c+"[</i><span class='qed-link-url'>"+d+"</span><i>]</i></span>"}function G(a,b){return"<span data-token-type='link-def'><i>[</i><span class='qed-link-key'>"+b+"</span><i>]: </i></span>"}function H(a){return a.replace(da,function(a){return q(a)})}function I(a){for(var b="",c=null,d=null,f=a;;){console.trace("TRYING",f);var g=f.charCodeAt(0);if(60!==g&&62!==g){if(c=N.exec(f)){if(d=c[0],console.trace("ESCAPE MATCHED",d),console.trace(f,f.length,c),b+=r(c[1]),f.length===d.length)break;f=f.substring(d.length)}else if(c=O.exec(f)){if(d=c[0],console.trace("BOLD MATCHED",d),b+=s("strong",c[1]?"__":"**",c[1]||c[2]),f.length===d.length)break;f=f.substring(d.length)}else if(c=P.exec(f)){if(d=c[0],console.trace("ITALIC MATCHED",d,c),b+=s("em",c[1]?"_":"*",c[1]||c[2]),f.length===d.length)break;f=f.substring(d.length)}else if(c=Q.exec(f)){if(d=c[0],console.trace("CODE MATCHED",d,c),b+=s("code","`",e(c[1])),f.length===d.length)break;f=f.substring(d.length)}else if(c=V.exec(f)){if(d=c[0],console.trace("URL MATCHED",d,c),b+=o("url",d),f.length===d.length)break;f=f.substring(d.length)}else if(c=S.exec(f)){if(d=c[0],console.trace("LINK MATCHED",d,c),b+=E(d,c[1],c[2]),f.length===d.length)break;f=f.substring(d.length)}else if(c=T.exec(f)){if(d=c[0],console.trace("LINK_REF MATCHED",d,c),b+=F(d,c[1],c[2],c[3]),f.length===d.length)break;f=f.substring(d.length)}else if(c=U.exec(f)){if(d=c[0],console.trace("LINK_DEF MATCHED",d,c),b+=G(d,c[1]),f.length===d.length)break;f=f.substring(d.length)}else if(c=R.exec(f)){if(d=c[0],console.trace("DEL MATCHED",d,c),b+=s("del","~~",c[1]),f.length===d.length)break;f=f.substring(d.length)}else if(c=W.exec(f)){if(d=c[0],console.trace("TEXT MATCHED",d),b+=d,f.length===d.length)break;f=f.substring(d.length),console.trace("INPUT ->",f)}else if(f)throw console.trace("ERROR",f),new Error('Infinite loop detected while higlighting inline styles on: "'+a+'". Remaining input: "'+f+'". Output: "'+b+'"')}else console.trace("TAG MARKER ->",f),b+=q(60===g?"<":">"),f=f.substring(1)}return b}var L={" ":"redrawActiveLine","	":"redrawActiveLine","#":"redrawActiveLine","`":"redrawActiveLine","*":"redrawActiveLine",_:"redrawActiveLine","~":"redrawActiveLine","<":"redrawActiveLine",">":"redrawActiveLine","=":"redrawActiveLine","-":"redrawActiveLine","[":"redrawActiveLine","]":"redrawActiveLine","(":"redrawActiveLine",")":"redrawActiveLine","!":"redrawActiveLine"},M={li:function(a){var b=a[0].trim();if("*"===b||"-"===b||"+"===b||/^[0-9]+\.$/.test(b))return void(a[0]="");var c=$.exec(a[0]);if(c)a[1]=c[0]+a[1],a.focusOffset=c[0].length;else if(c=Z.exec(a[0])){var d=c[1],e=c[0].replace(d,(parseInt(d)+1).toString());a[1]=e+a[1],a.focusOffset=c[0].length}},quote:function(a,b){var c=_.exec(a[0]);c&&(b&&c[0].length===a[0].length?a[0]="":(a[1]=c[0]+a[1],a.focusOffset=c[0].length))},code:function(a,b){var c=/^[ \t]+/.exec(a[0]);c&&(b&&c[0].length===a[0].length?a[0]="":(a[1]=c[0]+a[1],a.focusOffset=c[0].length))},"alt-code":function(a){}};this.initDocument=function(a){if(!a.firstElementChild){n(a);var c=b();return a.appendChild(c),c}},this.split=function(a,b,c,e){var f=d(a),g=[b,c];g.focusLine=1,g.focusOffset=0;var h=M[f];return h&&h(g,e),g},this.updateLine=function(a,b){null==b&&(b=a.textContent);var c=a.previousElementSibling,d=a.nextElementSibling,e=u(c,b);return h(e,c),d&&(h(d,e),l(d,e)),e},this.insertLines=function(a,b){if(!b||0===b.length)return a;for(var c=a.parentNode,d=a.previousElementSibling,e=0,f=b.length;f>e;e++){var g=u(d,b[e]);c.insertBefore(g,a),h(g,d),d=g}return h(a,d),l(a,d),d},this.appendLines=function(a,b){for(var c=a.lastElementChild,d=0,e=b.length;e>d;d++){var f=u(c,b[d]);a.appendChild(f),h(f,c),c=f}return c},this.replaceLines=function(a,c,d){var e=a.parentNode,f=m(a,c);if(d&&d.length>0)f=f?this.insertLines(f,d):this.appendLines(e,d);else if(f){var g=f.previousElementSibling;h(f,g),f=l(f,g)}else f=b(),e.appendChild(f),h(f,f.previousElementSibling);return f},this.updateDocument=function(a,c){if(n(a),!c||0===c.length){var d=b();return a.appendChild(d),d}return this.appendLines(a,c)},this.removeLines=function(a,b){return this.replaceLines(a,b,null)},this.removeLine=function(a){return this.replaceLines(a,a,null)},this.toHTML=function(a){return marked(a)},this.isLineInvalidated=function(a,b,c){if(L[c])return!0;if(g(a,b.focusNode))return!0;var e=b.focusNode.nodeValue;if(!(e.length>1))return!0;if(L[e.charAt(b.focusOffset)]||L[e.charAt(b.focusOffset-2)])return!0;var f=d(a);return"alt-heading"===f?!0:!1};var N=/^\\([\\`*{}\[\]()#+\-.!_>])/,O=/^__([\s\S]+?)__(?!_)|^\*\*([\s\S]+?)\*\*(?!\*)/,P=/^\b_((?:__|[\s\S])+?)_\b|^\*((?:\*\*|[\s\S])+?)\*(?!\*)/,Q=/^`([^`]+)`/,R=/^~~([^~]+)~~/,S=/^!?\[([^\]]+)\]\(([^\)]+)\)/,T=/^\[([^\]]+)\](\s?)\[([^\]]*)\]/,U=/^\[([^\]]+)\]: /,V=/^(https?:\/\/[^\s<"']+[^<.,:;"')\]\s])/,W=/^[\s\S]+?(?=[\\<>!\[_*`~]|https?:\/\/| {2,}\n|$)/,X=/^``` *(?:\S+)? *(?=\n|$)/,Y=/^ *(#{1,6})/,Z=/^\s*([1-9]+[0-9]*)\. +/,$=/^\s*([*+-]) +/,_=/^ *> */,aa=/^ *(?:> *)+/,ba=/^=+\n?$/,ca=/^-+\n?$/,da=/[<>]/g}function J(a){var b=a.firstChild;if(!b.nextSibling&&3===b.nodeType){var c=b.nodeValue;return!c||"\n"===c}return!1}function K(a){for(var b=t(a);b;){if(b.nodeValue.trim())return!1;b=s(a,b)}return!0}function L(a){return a.replace(/\r\n?/g,"\n")}function M(a){return 10===a.charCodeAt(a.length-1)&&(a=a.substring(0,a.length-1)),a}function N(a,b,c){if(c>=0){var d=x(b,c);if(d)return a.collapse(d[0],d[1]),!0}var e=w(b);if(e){var f=e.nodeValue;if(f.length>0){var c=f.length;10===f.charCodeAt(f.length-1)&&c--,a.collapse(e,c)}else a.collapse(e,0);return!0}return!1}function O(a,c){this.doc=a,this.elem=c,this.lineIndex=-1,this.getLineIndex=function(){return this.lineIndex<0&&this.elem.parentNode&&(this.lineIndex=b(this.elem)),this.lineIndex},this.next=function(){var a=this.elem.nextElementSibling;return a?new O(this.doc,a):null},this.previous=function(){var a=this.elem.previousElementSibling;return a?new O(this.doc,a):null},this.getLineOffset=function(){var a=t(this.elem);return a?y(this.doc.elem,a,0):-1},this.getCaretOffset=function(){var a=this.doc.getSelection();return a.focusNode?y(this.elem,a.focusNode,a.focusOffset):-1},this.setCaretOffset=function(a){return N(this.doc.getSelection(),this.elem,a)},this.getEndOfLineOffset=function(){var a=this.getText();return 10===a.charCodeAt(a.length-1)?a.length-1:a.length},this.getText=function(){return this.elem.textContent},this.attr=function(a,b){switch(arguments.length){case 1:return this.elem.getAttribute(a);case 2:null==b?this.elem.removeAttribute(a):this.elem.setAttribute(a,b)}return this},this._setElement=function(a){if(this.lineIndex=-1,this.elem.parentNode){var b=this.elem;return this.elem.parentNode.replaceChild(a,this.elem),this.elem=a,b}return this.elem=a,null},this.setText=function(a){return this._setElement(this.doc.formatter.updateLine(this.elem,a)),this},this.scrollToReveal=function(){q(this.doc.elem,this.elem)}}function P(a,b){function e(a,b,c){var e=d(b,c);return e?3!==e.nodeType?(b=e,(e=t(b))?[e,0]:(e=s(a,b))?[e,0]:(e=v(a,b),e?[e,e.nodeValue.length]:null)):[e,0]:(e=w(b))?[e,e.nodeValue.length]:(e=s(a,b))?[e,0]:(e=v(a,b),e?[e,e.nodeValue.length]:null)}this.elem=a,this.formatter=b,this.getLineElement=function(a){for(var b=this.elem,c=a;c&&c.parentNode!==b;)c=c.parentNode;return c&&1===c.nodeType?c:null},this.getFirstLineElement=function(){return this.elem.firstElementChild},this.getLastLineElement=function(){return this.elem.lastElementChild},this.getSelection=function(){return window.getSelection()},this.createRange=function(){return new H(this)},this.getFocusRange=function(){return new H(this).fromSelection(this.getSelection())},this.getFirstLine=function(){var a=this.getFirstLineElement();return a?new O(this,a):null},this.getLastLine=function(){var a=this.getLastLineElement();return a?new O(this,a):null},this.getLineAt=function(a){var b=c(this.elem,a);return b?new O(this,b):null},this.getLine=function(a){return a=this.getLineElement(a),a?new O(this,a):null},this.getFocusLine=function(){var a=getSelection().focusNode;return a?(a=this.getLineElement(a),a?new O(this,a):null):null},this.getText=function(){return this.elem.textContent},this.setText=function(a){var b=a&&"\n"!==a?M(L(a)).split("\n"):null;return this.formatter.updateDocument(this.elem,b),this},this.clear=function(){return this.setTex(null),this.getLastLine().setCaretOffset(0),this},this.toTextSelection=function(a){var b,c;if(3!==a.anchorNode.nodeType&&(b=e(this.elem,a.anchorNode,a.anchorOffset),!b))return console.error("broken document - no text node found",this.elem.innerHTML),this.clear(),this.getSelection();if(3!==a.anchorNode.nodeType&&(c=e(this.elem,a.focusNode,a.focusOffset),!c))return console.error("broken document - no text node found",this.elem.innerHTML),this.clear(),this.getSelection();if(b||c){var d=D();b?d.setStart(b[0],b[1]):d.setStart(a.anchorNode,a.anchorOffset),c?d.setEnd(c[0],c[1]):d.setEnd(a.focusNode,a.focusOffset),a.removeAllRanges(),a.addRange(d)}return a},this.adjustFocus=function(){var a=this.getSelection();if(a.focusNode&&a.anchorNode&&(a=this.toTextSelection(a),a.isCollapsed)){var b=a.focusNode;if(b.parentNode==this.elem){var c=b.nextElementSibling;if(c)return void new O(this,c).setCaretOffset(0);var d=b.previousElementSibling;if(d)return void new O(this,d).setCaretOffset(-1);console.error("Broken doc: "+this.elem.textContent),this.clear()}var e=b.nodeValue;a.focusOffset===e.length&&10===e.charCodeAt(e.length-1)&&a.collapse(b,a.focusOffset-1)}},this.formatter.initDocument(this.elem)}function Q(){this.text,this.focus,this.apply=function(a){a.setText(this.text),a.createRange().restore(this.focus).select()}}function R(a,b){return a&&a.text===b.text?!0:!1}function S(a,b){this.editor=a,this.undoStack=[],this.redoStack=[],this.size=b||50,this.listeners=new A(this),this.kcnt=0,this.addListener=function(a){return this.listeners.add(a)},this.canUndo=function(){return this.undoStack.length>1},this.canRedo=function(){return this.redoStack.length>0},this.undo=function(){if(!this.canUndo())return null;if(0===this.redoStack.length){var a=this.editor.doc.getFocusRange();a.isValid()&&this.push(a.takeSnapshot())}var b=this.undoStack.pop();this.redoStack.push(b);var c=this.undoStack.length-1;return this.undoStack[c].apply(this.editor.doc),this.listeners.fire(),b},this.redo=function(){var a=this.redoStack.pop();return a?(a.apply(this.editor.doc),this.undoStack.push(a),this.listeners.fire(),a):null},this.push=function(a){var b=this.undoStack,c=b.length>0?b[b.length-1]:null;this.kcnt=0,this.redoStack.length=0,R(c,a)||(b.length>this.size&&b.shift(),b.push(a)),this.listeners.fire()},this.init=function(a){this.redoStack.length=0;var b=new Q;b.text=a||"\n",b.focus=[0,0,0,0],this.undoStack.length=0,this.undoStack.push(b),this.listeners.fire()},this.shouldTakeSnapshot=function(a){return this.redoStack.length&&(this.redoStack.length=0,this.listeners.fire()),this.kcnt++,this.undoStack.length<=1||this.kcnt>32||!a.trim()||" .,;!?".indexOf(a)>-1}}function T(a){var b=qa[a.which];if(b)for(var c=0,d=b.length;d>c;c++){var e=b[c];if(e.testModifiers(a))return sa[e.id]}return null}function U(a,b){var c=b.toUpperCase().split("+");if(c.length<2)return null;for(var d=[],e=Y.mods,f=0,g=c.length-1;g>f;f++){var h=e[c[f]];null!=h&&d.push(h)}if(0===d.length)return null;var i=c[c.length-1],j=i.length>1&&"#"===i.charAt(0)?parseInt(i.substring(1)):i.charCodeAt(0);return new Y(a,j,d)}function V(a,b){var c=U(a,b);if(!c)throw new Error("Invalid hot key: "+b);var d=qa[c.key];return d||(d=[],qa[c.key]=d),d.push(c),c}function W(a,b,c){if("string"==typeof b)V(a,b),c||(c=b);else{for(var d=0,e=b.length;e>d;d++)V(a,b[d]);c||(c=b[0])}ra[a]=c}function X(a,b){b&&(ra={},qa={});for(var c=0,d=a.length;d>c;c++){var e=a[c];W(e.action,e.key,e.title)}}function Y(a,b,c){this.id=a,this.key=b,this.mods=c,this.test=function(a){return a.which!==this.key?!1:this.testModifiers(a)},this.testModifiers=function(a){for(var b=this.mods,c=0,d=b.length;d>c;c++)if(!b[c](a))return!1;return!0}}function Z(a,b,c,d,e){var f=!0;b.isCollapsed()||b.isMultiline()||(d=b.getText(),f=!1),b.insertText(c+d+e),f&&(b.focusOffset=b.focusOffset-e.length,b.anchorOffset=b.focusOffset-d.length),b.select()}function $(a,b,c,d,e){var f=b.expandToBoundingLines().getText(),g=b.anchorLine.previous();f.trim()&&(d=f),b.insertText(c+"\n"+d+"\n"+e),b.focusLine=b.focusLine.previous(),b.anchorLine=g?g.next().next():a.doc.getFirstLine().next(),b.expandToBoundingLines().select();
}function _(a,b,c,d){var e=a.getOrInitFocusRange();Z(a,e,b,c,d),a.takeSnapshot(e)}function aa(a,b){var c=a.getOrInitFocusRange();c.prefixLines(b).select(),a.takeSnapshot(c)}function ba(a,b,c){var d=a.getOrInitFocusRange();if(d.isMultiline()||"heading"!==d.focusLine.attr("data-line-type"))aa(a,c+" ");else{var e=d.focusLine,f=parseInt(e.attr("data-level")),g=e.getText(),h=g.indexOf("#");f===b?(g.charCodeAt(h+f)<=32&&f++,d.replaceLineText("",h,f)):d.replaceLineText(c,h,f),d.select(),a.takeSnapshot(d)}}function ca(a,b){for(var c=[],d=a,e=b.nextElementSibling;d!==e;){var f=d.textContent,g=f.indexOf(". ");g>-1&&c.push(f.substring(g+2)),d=d.nextElementSibling}return c}function da(a,b){for(var c=b||0,d=0,e=a.length;e>d;d++)a[d]=++c+". "+a[d];return a}function ea(a,b,c){var d=[],e=a,f=b.nextElementSibling;for(c+=" ";e!==f;){var g=e.textContent,h=g.indexOf(c);h>-1&&d.push(g.substring(h+c.length)),e=e.nextElementSibling}return d}function fa(a,b){for(var c=0,d=a.length;d>c;c++)a[c]=b+" "+a[c];return a}function ga(a,b){var c=a.getOrInitFocusRange();if("li"===c.focusLine.attr("data-line-type")){var d=c.focusLine.attr("data-bullet"),e=d.charCodeAt(0),f=58>e&&e>47;if(b!==f){c.collapse();for(var g=c.focusLine.elem,h=g,i=g,j=[],k=g.previousElementSibling;k&&k.getAttribute("data-bullet");)h=k,k=k.previousElementSibling;for(k=g.nextElementSibling;k&&k.getAttribute("data-bullet");)i=k,k=k.nextElementSibling;var j;j=f?fa(ca(h,i),"*"):da(ea(h,i,d),0);var l=c.save();c.doc.formatter.replaceLines(h,i,j),c.restore(l).select()}else{var m=c.focusLine.getText(),n=m.indexOf(d);n>-1&&(n+=d.length,m.charCodeAt(n+1)<=32&&n++,c.replaceLineText("",0,n).select(),c.doc.formatter.insertLines(c.focusLine.elem,[""]))}a.takeSnapshot(c)}else b?aa(a,"1. "):aa(a,"* ")}function ha(){this.ktype=0,this.textarea=null,this.doc=null,this.undoMgr=new S(this),this.changeListeners=new B(this,200),this.observer=null,this.savedFocusRange=null,this.insertImage=null,this.suggest=null,this.dropFiles=null,this.element=function(){return this.doc.elem},this.focus=function(){this.getOrInitFocusRange().select()},this.getOrInitFocusRange=function(){var a=this.doc.getFocusRange();return a.isValid()?a:this.savedFocusRange&&(a.restore(this.savedFocusRange),a.isValid())?a.select():a.collapseTo(this.doc.getFirstLine(),0).select()},this.installSuggest=function(a,b){return this.suggest=new na.Suggest(this,a),this},this._startObserver=function(a){var b=this;this.observer=new MutationObserver(function(a,c){b._onDomChange(a,c)}),this.observer.observe(this.doc.elem,{childList:!0,attributes:!1,characterData:!0,subtree:!0,characterDataOldValue:!1})},this._stopObserver=function(){this.observer.disconnect(),this.observer=null},this.takeSnapshot=function(a){this.undoMgr.push(a.takeSnapshot())},this.addChangeListener=function(a){return this.observer||this._startObserver(),this.changeListeners.add(a)},this.removeChangeListener=function(a){var b=this.changeListeners.remove(a);return 0===this.changeListeners.listeners.length&&this._stopObserver(),b},this._onDomChange=function(a,b){this.changeListeners.fire()},this.handleEnter=function(a){var b=this.doc.getFocusRange();b.split(!!a.ctrlKey).select(),b.focusLine.scrollToReveal(),this.takeSnapshot(b)},this.handleDelete=function(a){var b=this.doc.getFocusRange();return a.altKey?b.removeNextWord().select():b.removeNextCharacter().select(),this.takeSnapshot(b),this.suggest&&this.suggest.keypress(b),!1},this.handleBackspace=function(a){var b=this.doc.getFocusRange();return a.altKey?b.removePreviousWord().select():b.removePreviousCharacter().select(),this.takeSnapshot(b),this.suggest&&this.suggest.keypress(b),!1},this.handleTab=function(a){var b=this.doc.getFocusRange();a.shiftKey?b.unprefixLines("	"):b.prefixLines("	"),b.select(),this.takeSnapshot(b)},this.onCut=function(a){a.preventDefault(),a.stopPropagation();var b=this.doc.getSelection();if(!b.isCollapsed){var c=b.toString(),d=null,e="text/plain";if(window.clipboardData&&void 0===a.clipboardData&&(a.clipboardData=window.clipboardData,e="Text"),a.clipboardData&&a.clipboardData.setData&&(d=a.clipboardData),d){d.setData(e,c);var f=this.doc.createRange().fromSelection(b);f.removeText().select(),this.takeSnapshot(f)}}},this.selectAndTakeSnapshot=function(a,b){if(null==b)a.select(),this.takeSnapshot(a);else{var c=this;window.setTimeout(function(){a.select(),c.takeSnapshot(a)},b)}},this.onPaste=function(a){a.preventDefault(),a.stopPropagation();var b=null,c=!1;if(window.clipboardData&&void 0===a.clipboardData&&(a.clipboardData=window.clipboardData,c=!0),a.clipboardData&&a.clipboardData.getData){if(na.toMarkdown)try{var d=a.clipboardData.getData("text/html");d&&(b=na.toMarkdown(d))}catch(a){}b||(b=a.clipboardData.getData("Text"))}if(null==b&&(b=prompt("Paste is not supported on your browser.\nJust hit CTRL+V (or CMD+V on MacOs) to paste the content now and then hit the enter key","Paste text here")),b){var e=this.doc.getFocusRange().insertText(b);c?this.selectAndTakeSnapshot(e,0):this.selectAndTakeSnapshot(e)}},this.onDrop=function(a){if(a.dataTransfer){var b=a.dataTransfer.files;if(b&&b.length>0&&this.dropFiles)this.dropFiles(b,a);else{var c=a.dataTransfer.getData("Text");if(c){var d=this.doc.getFocusRange().insertText(c).select();this.takeSnapshot(d)}}}a.preventDefault(),a.stopPropagation()},this.onDragOver=function(a){if(a.dataTransfer){var b=a.dataTransfer.types;if(b)for(var c=0,d=b.length;d>c;c++){var e=b[c];("Files"===e||"text/plain"===e)&&(a.dataTransfer.dropEffect="copy")}}a.preventDefault()},this.onKeydown=function(a){var b=a.which;if(!(b>32&&41>b)){switch(b){case 16:case 17:case 18:case 91:case 92:return}this.doc.adjustFocus();var c=T(a);return c?(c(this),!1):13===b?(this.handleEnter(a),!1):9===b?(this.handleTab(a),!1):8===b?this.handleBackspace(a):46===b?this.handleDelete(a):void 0}},this.onKeypress=function(a){if(!a.ctrlKey&&!a.metaKey){var b=a.which,c=32>b?null:String.fromCharCode(b);if(c){var d=this.doc,e=d.getSelection();this.ktype|=1,this.undoMgr.shouldTakeSnapshot(c)&&(this.ktype|=2),e.isCollapsed||(d.getFocusRange().removeText().select(),e=d.getSelection());var f=d.getLineElement(e.anchorNode);f&&d.formatter.isLineInvalidated(f,e,c)&&(this.ktype|=4)}}},this.onKeyup=function(a){var b=this.doc,c=b.getSelection();if(!c.focusNode||3!==c.focusNode.nodeType){var d=x(c.focusNode,c.focusOffset);if(d&&(c.collapse(d[0],d[1]),c=b.getSelection()),!c.focusNode||3!==c.focusNode.nodeType)return void console.error("Invalid editor context ",c.focusNode,c.focusOffset)}var e=null;if(1!==a){if(e=b.getFocusRange(),!e.isValid())return;(2&a)>0&&this.takeSnapshot(e),(4&a)>0&&e.refresh().select()}this.suggest&&this.suggest.keypress(e||b.getFocusRange())},this.create=function(b){b.setAttribute("contenteditable","true"),this.doc=new P(b,new I),this.undoMgr.init();var c=this;return b.addEventListener("keydown",function(b){if(a(b),c.suggest&&c.suggest.keydown(b))return b.preventDefault(),void b.stopPropagation();var d=c.onKeydown(b);d===!1&&(b.preventDefault(),b.stopPropagation())}),b.addEventListener("keypress",function(b){a(b),c.onKeypress(b)}),b.addEventListener("keyup",function(b){a(b);var d=c.ktype;c.ktype=0,d>0&&!b.ctrlKey&&!b.metaKey&&c.onKeyup(d)}),b.addEventListener("paste",function(a){c.onPaste(a)}),b.addEventListener("cut",function(a){c.onCut(a)}),b.addEventListener("drop",function(a){c.onDrop(a)}),b.addEventListener("dragover",function(a){c.onDragOver(a)}),b.addEventListener("blur",function(){var a=c.doc.getFocusRange();c.savedFocusRange=a.isValid()?a.save():null,c.sync()}),this},this.destroy=function(){this.textarea&&(this.sync(),this.doc.elem.parentNode.removeChild(this.doc.elem),this.textarea.style.display="none")},this.sync=function(){return this.textarea&&(this.textarea.value=this.getText()),this},this.autosync=function(a){this.textarea=a},this.setInitialText=function(a){this.doc.setText(a),this.undoMgr.init(a)},this.setText=function(a){this.doc.setText(a),this.takeSnapshot(this.getOrInitFocusRange())},this.getText=function(){return this.doc.getText()},this.getTextAsHtml=function(){return marked(this.doc.getText())},this.exec=function(a){var b=na.actions[a];return b?b(this):null},this.insertSelectedText=function(a,b,c){_(this,a,b,c)},this.insertText=function(a){this.doc.getFocusRange().insertText(a).select()}}function ia(a,b){function c(a,b){var c=b.getBoundingClientRect(),d=a.getBoundingClientRect(),e=c.top-d.top,f=c.bottom-d.top;f>a.clientHeight?a.scrollTop+=f-a.clientHeight+50:0>e&&(a.scrollTop+=e-500)}this.elem=a,this._reg=null,this.transformers=b||[],this.connect=function(a){if(this._reg)return this;this.syncAndFocus(a);var b=this;return this._reg=a.addChangeListener(function(){b.syncAndFocus(a)}),this},this.disconnect=function(){return this._reg?(this._reg.remove(),this._reg=null,!0):!1},this.isConnected=function(){return!!this._reg},this._transform=function(a){for(var b=this.transformers,c=this.elem,d=0,e=b.length;e>d;d++)b[d](c,a)},this.sync=function(a){return this.elem.innerHTML=a.doc.formatter.toHTML(a.doc.getText()),this._transform(!1),this},this.syncAndFocus=function(a){var b=a.doc,d=this.elem,e=b.getText(),f=b.getFocusLine(),g="$$$QED$CARET$MARKER$$$";if(f){var h=f.getLineOffset(),i=e.indexOf("\n",h);if(i>-1){if(h>0&&!e.substring(h,i).trim()){var j=f.previousElementSibling;j&&"end"!==j.getAttribute("data-block")&&(i=h-1)}else i>1&&"  "===!e.substring(i-2,i)&&(i-=2);e=e.substring(0,i)+" "+g+e.substring(i)}else e+=" "+g}var k=b.formatter.toHTML(e),h=k.indexOf(g);if(h>-1){var l="QED_CARET_MARKER_"+la++;d.innerHTML=k.substring(0,h)+"<i id='"+l+"'></i>"+k.substring(h+g.length);var m=document.getElementById(l);m&&c(d,m)}else d.innerHTML=k;this._transform(!0)}}function ja(){function b(a,b){for(var c in a)if(a.hasOwnProperty(c)){var d=a[c].elem.firstElementChild;if(d){var e=d.getAttribute("data-action");"preview"!==e&&(d.disabled=b)}}}function c(a){for(var b=a;b&&!l(b,"qed-toolbar")&&!b.getAttribute("data-action");)b=b.parentNode;return b}function d(a,b,c,d,e){b.innerHTML="<button type='button' title='"+(e||"")+"' data-action='"+c+"' class='qed-toolbar-action'>"+d+"</button>"}function e(a,b){var c,e="qed-toolbar-item",g=document.createElement("LI");if("|"===b)e="qed-toolbar-separator",c=new f;else if("string"==typeof b)e="qed-toolbar-text",c=new h(b);else{var k=b.name,l=na.actions[k];if(l){if(b.title){var n=ra[k];n&&(b.title+=" ("+n+")")}c=new i(b)}else"fullscreen"===k?c=new m(b,function(a){return a.isFullScreen()},function(a){return a._toggleFullScreen()}):"preview"===k?c=new m(b,function(a){return a.isPreviewMode()},function(a){return a._togglePreview()}):(c=b,c.create||(c.create=function(a,b){d(a,b,this.name,this.label,this.title),this.elem=b}))}return c.create(a,j(g,e)),c}function f(){this.exec=ma,this.create=function(a,b){this.elem=b}}function h(a){this.elem=null,this.html=a,this.create=function(a,b){b.innerHTML=this.html,this.elem=b},this.exec=ma}function i(a){this.elem=null,this.data=a,this.create=function(a,b){d(a,b,this.data.name,this.data.label,this.data.title),this.elem=b},this.exec=function(a){a.editor.exec(this.data.name)}}function m(a,b,c){this.elem=null,this.data=a,this.getLabel=function(a){return(this.isOn(a)?this.data.labelOn:this.data.labelOff)||this.data.label},this.create=function(a,b){d(a,b,this.data.name,this.getLabel(a),this.data.title),this.elem=b},this.isOn=b,this.exec=c,this.refresh=function(a){this.elem.firstElementChild.innerHTML=this.getLabel(a)}}this.elem=null,this.editor=null,this.preview=null,this.height=null,this.tbarItems={},this.setText=function(a){return this.editor.setText(a),this},this.setInitialText=function(a){return this.editor.setInitialText(a),this},this.getText=function(){return this.editor.getText()},this.getId=function(){return this.elem.getAttribute("id")},this._togglePreview=function(){var a;l(this.elem,"preview")?(k(this.elem,"preview"),b(this.tbarItems,!1),this.editor.doc.elem.focus(),a=!1):(j(this.elem,"preview"),b(this.tbarItems,!0),this.preview&&this.preview.sync(this.editor),this.preview.elem.focus(),a=!0),this._refreshUndoBar();var c=this.tbarItems.preview;return c&&c.refresh(this),a},this._toggleFullScreen=function(){var a;l(this.elem,"fullscreen")?(k(this.elem,"fullscreen"),this.preview.disconnect(),this._adjustHeight(),a=!1):(j(this.elem,"fullscreen"),this.preview&&this.preview.sync(this.editor).connect(this.editor),this._adjustHeight(),a=!0),this.editor.doc.elem.focus();var b=this.tbarItems.fullscreen;return b&&b.refresh(this),a},this.isPreviewMode=function(){return l(this.elem,"preview")},this.isFullScreen=function(){return l(this.elem,"fullscreen")},this._adjustHeight=function(){var a=this.height;if(this.isFullScreen()){var b=this.elem.querySelector(".qed-toolbar");b&&(a=this.elem.clientHeight-b.offsetHeight)}a&&(a+="px",this.editor.doc.elem.style.height=a,this.preview&&(this.preview.elem.style.height=a))},this.create=function(b,c){var d=b.tagName.toUpperCase(),e=null,f=null,h=null,i=null;if("TEXTAREA"===d||"INPUT"===d&&"hidden"===b.getAttribute("type")){e=b,b=document.createElement("DIV"),h=document.createElement("DIV"),f=document.createElement("DIV"),i=document.createElement("DIV");var k=document.createElement("DIV");j(b,"qed-container"),j(h,"qed-toolbar"),j(h,"clearfix"),j(f,"qed-preview"),j(i,"qed-editor"),j(k,"qed-panel"),j(k,"clearfix"),p(h),b.appendChild(h),b.appendChild(k),k.appendChild(i),k.appendChild(f)}else h=b.querySelector(".qed-toolbar"),f=b.querySelector(".qed-preview"),i=b.querySelector(".qed-editor");if(!i)throw new Error("Didn't found any '.qed-editor' element");this.elem=b;var m=b.getAttribute("id");if(m||(m="qed-editor-"+la++),this.editor=(new ha).create(i),f){var n=c?c.previewTransforms:null;f.tabIndex=-1,this.preview=new ia(f,n)}e&&(p(e),e.parentNode.insertBefore(b,e),this.editor.autosync(e),e.value&&this.editor.setInitialText(e.value));var o=this,q=!1;if(c&&(c.suggest&&this.editor.installSuggest(c.suggest),c.insertImage&&(this.editor.insertImage=c.insertImage),c.dropFiles&&(this.editor.dropFiles=c.dropFiles),c.height&&(this.height=c.height,this._adjustHeight()),h&&this._buildToolbar(h,c.leftBar,c.rightBar),q=!!c.fullscreen,q&&this._toggleFullScreen(),c.autofocus&&this.editor.getOrInitFocusRange().select(),c.confirmOnLeave)){var r=c.submittingClass||"submitting";window.onbeforeunload=function(a){var b=g(o.elem,"form");if(!(o.submitting||b&&l(b,r)))return o.editor.undoMgr.canUndo()?c.confirmOnLeave:void 0}}return this.elem.addEventListener("keydown",function(b){a(b);var c=!1;switch(b.which){case 27:!q&&o.isFullScreen()&&(o._toggleFullScreen(),c=!0);break;case 70:b.ctrlKey&&b.shiftKey?q||(o._toggleFullScreen(),c=!0):b.ctrlKey&&(o._togglePreview(),c=!0)}c&&(b.preventDefault(),b.stopPropagation())}),this},this.destroy=function(){},this._buildToolbar=function(a,b,d){if(b&&b.length>0&&a.appendChild(this._buildBar("qed-toolbar-left",b)),d&&d.length>0&&a.appendChild(this._buildBar("qed-toolbar-right",d)),!a.firstElementChild)return!1;var e=this;return a.addEventListener("click",function(a){var b=c(a.target);if(b&&!b.disabled){var d=b.getAttribute("data-action"),f=e.tbarItems[d];f&&(a.preventDefault(),a.stopPropagation(),f.exec(e))}}),this._refreshUndoBar(),this.editor.undoMgr.addListener(function(){e._refreshUndoBar()}),o(a),!0},this._refreshUndoBar=function(){var a=this.editor.undoMgr,b=this.tbarItems.undo,c=this.tbarItems.redo;b&&(b.elem.querySelector("button").disabled=!a.canUndo()),c&&(c.elem.querySelector("button").disabled=!a.canRedo())},this._buildBar=function(a,b){for(var c=j(document.createElement("UL"),a),d=0,f=b.length;f>d;d++){var g=b[d],h=e(this,g);c.appendChild(h.elem),g.name&&(this.tbarItems[g.name]=h)}return c}}var ka=-1!=navigator.userAgent.indexOf("Mac OS X"),la=0,ma=function(){},na={resolve:function(a){return"string"==typeof a?document.querySelector(a):a},create:function(a,b){return(new ja).create(na.resolve(a),b)}},oa=/^[\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]*([^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]*)/,pa=/([^\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]*)[\u2000-\u206F\u2E00-\u2E7F\s\\'!"#$%&()*+,\-.\/:;<=>?@\[\]^_`{|}~]*$/;na.Range=Range,console.trace=function(){},na.Line=O,na.Document=P,na.Snapshot=Q,Y.mods={CTRL:function(a){return a.ctrlKey},ALT:function(a){return a.altKey},SHIFT:function(a){return a.shiftKey},META:function(a){return a.metaKey},APPLE:function(a){return ka&&a.metaKey}};var qa={},ra={},sa={undo:function(a){a.undoMgr.undo()},redo:function(a){a.undoMgr.redo()},bold:function(a){_(a,"**","type here","**")},italic:function(a){_(a,"_","type here","_")},strike:function(a){_(a,"~~","type here","~~")},link:function(a){var b=prompt("Enter link URL (must start with http:// or https://)");b&&(0===b.indexOf("http://")||0===b.indexOf("https://")?_(a,"[","type a link title","]("+b+")"):alert("Not a valid URL"))},image:function(a){a.insertImage&&a.insertImage()},code:function(a){var b=a.getOrInitFocusRange();b.isMultiline()||b.isCollapsed()&&J(b.focusLine.elem)?$(a,b,"```","type here","```"):Z(a,b,"`","type here","`"),a.takeSnapshot(b)},h1:function(a){ba(a,1,"#")},h2:function(a){ba(a,2,"##")},h3:function(a){ba(a,3,"###")},ul:function(a){ga(a,!1)},ol:function(a){ga(a,!0)},quote:function(a){aa(a,"> ")},br:function(a){var b=a.doc.getFocusRange();b.split(!0).select(),b.focusLine.scrollToReveal(),a.takeSnapshot(b)},refresh:function(a){a.doc.setText(a.getText())}};return X([{action:"undo",key:["Ctrl+Z","APPLE+Z"]},{action:"redo",key:["Ctrl+Y","APPLE+Y"]},{action:"bold",key:"Ctrl+B"},{action:"italic",key:"Ctrl+I"},{action:"strike",key:"Ctrl+D"},{action:"link",key:"Ctrl+L"},{action:"code",key:"Ctrl+K"},{action:"ul",key:"Ctrl+U"},{action:"ol",key:"Ctrl+O"},{action:"quote",key:"Ctrl+#190",title:"Ctrl+."}]),na.actions=sa,na.loadHotKeys=X,na.setHotKeys=W,na.Editor=ha,na.Preview=ia,na.EditorContainer=ja,function(a){function b(a,b){this.ctx=a||null,this.fn=b;var c=this;return function(){var a=arguments.length>0?Array.prototype.slice.call(arguments):null;c.fn.apply(c.ctx,a)}}function c(a,b,c){this.ctx=a||null,this.fn=b,this.delay=c||300,this.args=null,this.timer=null,this.deferCall=function(){var a=this.ctx,b=this.fn,c=this.args;this.timer=window.setTimeout(function(){b.apply(a,c)},this.delay)};var d=this;return function(){d.timer&&(window.clearTimeout(d.timer),d.timer=null),d.args=arguments.length>0?Array.prototype.slice.call(arguments):null,d.deferCall()}}function d(a){this.impl=a,this.elt=null,this.term=null,this.fetching=!1,this._create=function(){var a=this.impl,b=document.createElement("DIV"),c="qed-suggest-popup";a.popupClass&&(c+=" "+a.popupClass),b.className=c;var d=b.style;d.position="absolute",d.overflowY="scroll";var e=this;b.addEventListener("click",function(a){a.__suggestPopup=e;var c=f(a.target,b,function(a){return!!a.__suggestItem});if(c){var d=b.querySelector("li.active");c!==d&&(k(d,"active"),j(c,"active")),e.complete()}}),b.addEventListener("mouseover",function(a){var c=f(a.target,b,function(a){return!!a.__suggestItem});if(c){var d=b.querySelector("li.active");c!==d&&(k(d,"active"),j(c,"active"))}}),document.addEventListener("click",function(a){a.__suggestPopup!==e&&e.close()}),this.elt=b,a.render&&(this._renderItem=a.render)},this._renderItem=function(a){var b=this.impl,c=document.createElement("LI");return c.appendChild(document.createTextNode(b.text(a))),c.__suggestItem=a,c},this._render=function(a){if(!a||!a.length)return null;for(var b=document.createElement("UL"),c=0,d=a.length;d>c;c++)b.appendChild(this._renderItem(a[c]));return j(b.firstChild,"active"),b},this._setContent=function(a){if(a){for(var b=this.elt;b.firstChild;)b.removeChild(b.firstChild);b.appendChild(a)}else this.close()},this.refresh=function(a){this._setContent(this._render(a))},this.show=function(a,b){if(a&&a.length)if(this.isOpened())this.refresh(a);else{var c=b.range.getCaretXY(),d=c[0],e=c[1];this.refresh(a);var f=this.elt.style;f.left=d+"px",f.top=e+"px",document.body.appendChild(this.elt)}else this.close()},this.isOpened=function(){return!!this.elt.parentNode},this.open=function(a){if(!(null==a||this.term&&this.term.value===a.value||this.fetching)){this.fetching=!0,this.term=a;var b=this;this.impl.fetch(a.value,function(c){try{c instanceof Error?console.error("Open Suggest : Server Error :",c.message):b.show(c,a)}finally{b.fetching=!1}})}},this.complete=function(){if(this.term){var a=this.getSelectionValue();a&&this.term.replace(a)}this.close()},this.close=function(){var a=this.elt;if(a.parentNode){for(document.body.removeChild(a);a.firstChild;)a.removeChild(a.firstChild);this.term=null}},this.getSelectedItem=function(){return this.elt.querySelector("li.active")},this.selectNextItem=function(a){var b=this.getSelectedItem();if(b){var c,d;a?(c="previousElementSibling",d="lastElementChild"):(c="nextElementSibling",d="firstElementChild");var e=b[c];return e||(e=b.parentNode[d]),e!==b&&(j(e,"active"),k(b,"active")),e}},this.getSelection=function(){var a=this.getSelectedItem();return a?a.__suggestItem:null},this.getSelectionValue=function(){var a=this.getSelectedItem();return a?this.impl.value(a.__suggestItem):null},this._create()}function e(a,b,c){this.range=a,this.value=b,this.offset=c,this.replace=function(b){a.anchorOffset=this.offset,a.insertText(b).select()}}function g(a,f){this.editor=a,this.impl=f,this.popup=new d(f),this.delay=void 0===f.delay?300:f.delay>0?f.delay:null,this.suggest=function(a,b,c){this.popup.open(new e(a,b,c))},this.trySuggest=function(){var a=this.editor.doc.getFocusRange();if(a.isValid()){var b=this.impl.term(a);null!=b?this.suggest(a,b[0],b[1]):this.popup.close()}};var g=this.delay?new c(this,this.trySuggest,this.delay):new b(this,this.trySuggest);if(this.keydown=function(a){var b=this.popup;if(b.isOpened())switch(a.which){case 13:case 9:return b.complete(),!0;case 27:return b.close(),!0;case 38:return b.selectNextItem(!0),!0;case 40:return b.selectNextItem(!1),!0}return!1},this.keypress=function(a){g()},!f.term||!f.fetch)throw new Error('Suggest implementation should provide a "term" and a "fetch" function');f.text||(f.text=function(a){return a}),f.id||(f.id=f.text),f.value||(f.value=f.text)}a.Suggest=g}(na),function(a){function b(a){return!!l[a]}function c(){try{if((new DOMParser).parseFromString("","text/html"))return!0}catch(a){}return!1}function d(){}function e(a){return 3===a.nodeType&&/^\s*$/.test(a.nodeValue)}function f(a,b){this.flushln().print(b).convertContent(a).flushln().println()}function g(a){this.flushln().convertContent(a).flushln().println()}function h(a){this.flushln().convertContent(a).flushln()}function i(a,b){this.print(b).convertContent(a).print(b)}function j(a,b){var c=this.pushList(b||0);c.parent?h.call(this,a):g.call(this,a),this.popList()}function k(a){this.text="",this.line="",this.converters=a||null,this.prefix="",this.currentList=null,this.println=function(a){var b=this.line.trim().replace(/\s+/g," ");return this.text+=this.prefix+b+(a||"\n"),this.line="",this},this.flushln=function(){return this.line&&this.println(),this},this.print=function(a){return this.line+=a,this},this.printRawBlock=function(a){return this.flushln(),this.text+=a,a.charCodeAt(a.length-1)>32&&(this.text+="\n"),this},this.printRawText=function(a){return this.flushln(),this.text+=a,this},this.push=function(a){return this.prefix+=a,this},this.pop=function(a){var b=this.prefix;return this.prefix=b.length>a.length?b.substring(0,b.length-a.length):"",this},this.pushList=function(a){var b=this.currentList,c=b?b.prefix+"    ":"";return this.currentList={parent:b,prefix:c,index:a||0},this.currentList},this.popList=function(){if(!this.currentList)return null;var a=this.currentList;return this.currentList=a.parent,a},this.convert=function(a){var b;if("string"==typeof a)b=m(a).body;else{if(!a.tagName)throw new Error("Expecting a string or DOM element");b=a}return this.convertElement(b,this),this.flushln(),this.text},this.convertElement=function(a){var c=a.tagName.toLowerCase(),d=null;this.converters&&(d=this.converters[c]),d||(d=n[c]),d?d.call(this,a):(this.convertContent(a),b(c)&&(this.flushln(),this.text.charCodeAt(this.text.lemgth-1)<=32&&(this.text+="\n")))},this.convertContent=function(a){var c=a.firstChild;if(!c)return this;var d=c,f=null,g=a.tagName.toLowerCase();if(b(g)){if(e(d)&&(d=d.nextSibling,!d))return this;c=a.lastChild,e(c)&&(f=c)}for(c=d;c!==f;){var h=c.nodeType;3===h?this.print(c.nodeValue):1===h&&this.convertElement(c),c=c.nextSibling}return this}}var l={html:!0,body:!0,p:!0,div:!0,pre:!0,blockquote:!0,h1:!0,h2:!0,h3:!0,h4:!0,h5:!0,h6:!0,ol:!0,ul:!0,li:!0,table:!0,tbody:!0,td:!0,tfoot:!0,th:!0,thead:!0,tr:!0,address:!0,article:!0,aside:!0,audio:!0,canvas:!0,center:!0,dd:!0,dir:!0,dl:!0,dt:!0,fieldset:!0,figcaption:!0,figure:!0,footer:!0,form:!0,frameset:!0,header:!0,hgroup:!0,isindex:!0,main:!0,menu:!0,nav:!0,noframes:!0,noscript:!0,output:!0,section:!0},m=c()?function(a){return(new DOMParser).parseFromString(a.trim(),"text/html")}:function(a){a=a.trim();var b=document.implementation.createHTMLDocument("");return"<!doctype"===a.substring(0,"<!doctype".length).toLowerCase()?b.documentElement.innerHTML=a:b.body.innerHTML=a,b},n={script:d,style:d,link:d,head:d,template:d,frame:d,iframe:d,br:function(a){this.println("  \n")},hr:function(){this.print("---").println()},i:function(a){i.call(this,a,"_")},b:function(a){i.call(this,a,"**")},del:function(a){i.call(this,a,"~~")},a:function(a){var b=a.getAttribute("href"),c=a.textContent,d=a.getAttribute("title");d&&(b+=' "'+d+'"'),this.print("["+c+"]("+b+")")},img:function(a){var b=a.getAttribute("src"),c=a.getAttribute("alt"),d=a.getAttribute("title");d&&(b+=' "'+d+'"'),this.print("!["+c+"]("+b+")")},p:function(a){g.call(this,a)},ol:function(a){j.call(this,a,1)},ul:function(a){j.call(this,a,0)},li:function(a){var b=(a.textContent,this.currentList);if(this.printRawText(b?b.prefix:""),b&&b.index>0){var c=b.index++;this.print(c+". ").convertContent(a).flushln()}else this.print("* ").convertContent(a).flushln()},h1:function(a){f.call(this,a,"# ")},h2:function(a){f.call(this,a,"## ")},h3:function(a){f.call(this,a,"### ")},h4:function(a){f.call(this,a,"#### ")},h5:function(a){f.call(this,a,"##### ")},h6:function(a){f.call(this,a,"###### ")},blockquote:function(a){this.flushln().push("> ").convertContent(a).pop("> ").flushln().println()},code:function(a){this.print("`"+a.textContent+"`")},pre:function(a){var b,c="",d=a.firstElementChild,e=a.lastElementChild;if(d===e&&"code"===d.tagName.toLowerCase()){var f=d.className;if(f){var g=f.indexOf(" ");c=g>-1?f.substring(0,g):f}b=d.textContent}else b=a.textContent;this.flushln().print("```"+c).printRawBlock(b).print("```").println().println()}};a.MdConverter=k,a.parseHTML=m,a.toMarkdown=function(a){return(new k).convert(a)}}(na),na});